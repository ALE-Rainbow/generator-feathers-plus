
/* eslint quotes: 0 */
// Validation definitions for validateSchema hook for service `<%= serviceName %>`. (Can be re-generated.)
const { validateSchema } = require('feathers-hooks-common')<%- sc %>
const merge = require('lodash.merge')<%- sc %>
const ajv = require('ajv')<%- sc %>
<%- insertFragment('imports') %>
<%- insertFragment('init') %>

<%- insertFragment('set_id_type', [
  `// ${lintDisableNextLine} no-unused-vars`,
  `const ID = 'string'${sc}`,
]) %>

let base = merge({},
<% __jsonSchema = merge({}, feathersSpecs[serviceName]);
   delete __jsonSchema._extensions;
   __str = stringifyPlus(__jsonSchema).replace(/"ID"/g, 'ID')
     .split('\n').map(str => `  ${str}`).join('\n');
-%>
  <%- insertFragment('base', Object.keys(__jsonSchema).length === 0 ? undefined : `${__str},`) %>
  <%- insertFragment('base_more') %>
)<%- sc %>
<%- insertFragment('base_change') %>

let create = merge({},
  base,
  <%- insertFragment('create_more') %>
)<%- sc %>

let update = merge({},
  base,
  <%- insertFragment('update_more') %>
)<%- sc %>

let patch = merge({},
  base,
  { required: undefined },
  <%- insertFragment('patch_more') %>
)<%- sc %>
<%- insertFragment('all_change') %>

let validateCreate = options => {
  <%- insertFragment('func_create', [
    `  return validateSchema(create, ajv, options)${sc}`,
  ]) %>
}<%- sc %>

let validateUpdate = options => {
  <%- insertFragment('func_update', [
    `  return validateSchema(update, ajv, options)${sc}`,
  ]) %>
}<%- sc %>

let validatePatch = options => {
  <%- insertFragment('func_patch', [
    `  return validateSchema(patch, ajv, options)${sc}`,
  ]) %>
}<%- sc %>

let quickValidate = (method, data, options) => {
  try {
    if (method === 'create') validateCreate(options)({ type: 'before', method: 'create', data })<%- sc %>
    if (method === 'update') validateCreate(options)({ type: 'before', method: 'update', data })<%- sc %>
    if (method === 'patch') validateCreate(options)({ type: 'before', method: 'patch', data })<%- sc %>
  } catch (err) {
    return err<%- sc %>
  }
}<%- sc %>
<%- insertFragment('validate_change') %>

let moduleExports = {
  create,
  update,
  patch,
  validateCreate,
  validateUpdate,
  validatePatch,
  quickValidate,
  <%- insertFragment('moduleExports') %>
}<%- sc %>

<%- insertFragment('exports') %>
module.exports = moduleExports<%- sc %>

<%- insertFragment('funcs') %>
<%- insertFragment('end') %>
