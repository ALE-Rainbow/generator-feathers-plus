
// Initializes the `<%= serviceName %>` service on path `/<%= path %>`
const createService = require('feathers-mongodb')<%- sc %>
const hooks = require('./<%= kebabName %>.hooks')<%- sc %>
<%- insertFragment('mongo_imports', [
  `// let $jsonSchema = require('./${kebabName}.mongo')${sc}`
]) %>
<%- insertFragment('mongo_init') %>

let moduleExports = function (app) {
  let paginate = app.get('paginate')<%- sc %>
  let mongoClient = app.get('mongoClient')<%- sc %>
  let options = { paginate }<%- sc %>
  <%- insertFragment('mongo_func_init') %>

  // Initialize our service with any options it requires
  app.use('/<%= path %>', createService(options))<%- sc %>

  // Get our initialized service so that we can register hooks and filters
  const service = app.service('<%= path %>')<%- sc %>

  mongoClient.then(db => {
    return db.createCollection('<%= kebabName %>', {
      <%- insertFragment('mongo_create_collection', [
        '      // validator: { $jsonSchema: $jsonSchema },',
        '      // validationLevel: \'strict\', // The MongoDB default',
        '      // validationAction: \'error\', // The MongoDB default',
      ]) %>
    })<%- sc %>
  })
    .then(serviceModel => {
      service.Model = serviceModel<%- sc %>
    })<%- sc %>

  service.hooks(hooks)<%- sc %>
  <%- insertFragment('mongo_func_return') %>
}<%- sc %>
<%- insertFragment('mongo_more') %>

<%- insertFragment('mongo_exports') %>
module.exports = moduleExports<%- sc %>

<%- insertFragment('mongo_funcs') %>
<%- insertFragment('mongo_end') %>
